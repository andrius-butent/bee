<?xml version="1.0" encoding="UTF-8"?>
<g:Grid xmlns="http://www.butent.com/column"
        xmlns:g="http://www.butent.com/grid"
        xmlns:ui="http://www.butent.com/ui"

        name="SelfServiceInvoices" viewName="SelfServiceInvoices"
        editShowId="true" flexGrow="1"
        disabledActions="add"
        caption="=trInvoices"
        filter="Sale AND !(Proforma)"
>
  <g:columns>
    <DataColumn name="Date" />
    <DataColumn name="Number" >
      <footer text="=totalOf" horizontalAlignment="right" />
    </DataColumn>
    <RelColumn name="Operation" />
    <DataColumn name="InvoiceNo" renderColumns="InvoicePrefix InvoiceNo"
                searchBy="InvoicePrefix InvoiceNo" />
    <RelColumn name="Customer" filterSupplier="value" />
    <RelColumn name="Payer" filterSupplier="value" />

    <PropColumn name="Vat" type="decimal" caption="=printItemVatAmount" format="#.##" >
      <footer aggregate="sum" format="#.##"/>
    </PropColumn>
    <PropColumn name="VatInEUR" type="decimal" caption="=printItemVatAmount+ +EUR" format="#.##" >
      <footer aggregate="sum" format="#.##"/>
    </PropColumn>
    <PropColumn name="WithoutVat" type="decimal" caption="=trdAmountWoVat" format="#.##"
                horizontalAlignment="right">
      <render>
        <ui:function>
          if (row.Vat) {
          return Math.round((row.Amount - row.Vat) * 100) / 100;
          } else {
          return row.Amount;
          }
        </ui:function>
      </render>
      <footer aggregate="sum" format="#.##"/>
    </PropColumn>
    <PropColumn name="WithoutVatEUR" type="decimal" caption="=trdAmountWoVat+ +EUR" format="#.##"
                horizontalAlignment="right">
      <render>
        <ui:function>
          if (row.VatInEUR) {
          return Math.round((row.AmountInEUR - row.VatInEUR) * 100) / 100;
          } else {
          return row.AmountInEUR;
          }
        </ui:function>
      </render>
      <footer aggregate="sum" format="#.##"/>
    </PropColumn>

    <DataColumn name="Amount" caption="=trTotalWithVAT" />
    <DataColumn name="CurrencyName" />
    <PropColumn name="AmountInEUR" type="double" format="0.00" caption="=trTotalWithVAT+ +EUR" >
      <footer aggregate="sum" />
    </PropColumn>

    <DataColumn name="Term" />

    <DataColumn name="PaymentTime" />
    <DataColumn name="Paid" />
    <PropColumn name="PaidInEUR" type="double" format="0.00" caption="=trdPaid+ +EUR">
      <footer aggregate="sum" />
    </PropColumn>

    <DataColumn name="Debt" format="0.00" />
    <CalcColumn name="DebtInEUR" type="double" caption="=trdDebt+ +EUR" format="0.00">
      <render>
        <ui:expression>row.AmountInEUR - (row.PaidInEUR == null ? 0 : row.PaidInEUR)</ui:expression>
      </render>
      <footer aggregate="sum" />
    </CalcColumn>

    <DataColumn name="Vehicle" />
    <DataColumn name="Driver" />

    <RelColumn name="Creator" readOnly="true" />
  </g:columns>

  <g:rowStyle>
    <ui:inline>="color:red"</ui:inline>
    <ui:expression>row.Debt &gt; 0 &amp;&amp; row.Term &lt; new Date().getTime()</ui:expression>
  </g:rowStyle>
  <g:rowStyle>
    <ui:inline>="color:green"</ui:inline>
    <ui:expression>row.Debt == 0</ui:expression>
  </g:rowStyle>
</g:Grid>