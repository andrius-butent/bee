<?xml version="1.0" encoding="UTF-8"?>
<View xmlns="http://www.butent.com/view"
      xmlns:x="http://www.butent.com/expression"

  name="DebtReports" source="Companies" caption="=trdDebtReports"
  
  >
  <Columns>
    <SimpleColumn name="Name" />
    
    <SimpleJoin name="Contact" joinType="LEFT">
      <SimpleJoin name="Email" joinType="LEFT">
        <SimpleColumn name="Email" />
      </SimpleJoin>
    </SimpleJoin>
        
    <ExternalJoin name="Customer" source="Sales" joinType="INNER" filter="(Amount > Paid OR !(Paid))" >
      <AggregateColumn name="Customer" aggregate="COUNT" alias="DebtCount"  label="=trInvoices" />
      <AggregateColumn name="Amount" aggregate="SUM" alias="AmountSum" />
      <AggregateColumn name="Paid" aggregate="SUM" alias="PaidSum" />
      <HiddenColumn name="Paid" />
      <HiddenColumn name="Amount" />
      <SimpleColumn name="Currency" />
      <SimpleJoin name="Currency" joinType="LEFT">
        <SimpleColumn name="Name" alias="CurrencyName"/>
      </SimpleJoin>
    </ExternalJoin>
     
    <SimpleColumn name="BankruptcyRisk"/>
    <SimpleJoin joinType="LEFT" name="BankruptcyRisk">
      <SimpleColumn alias="BankruptcyRiskName" name="Name" />
    </SimpleJoin>
    
    <SimpleColumn name="DelayedPaymentRisk"/>
    <SimpleJoin joinType="LEFT" name="DelayedPaymentRisk">
      <SimpleColumn alias="DelayedPaymentRiskName" name="Name" />
    </SimpleJoin>
  </Columns>
  <Order>
    <OrderBy column="Name" />
  </Order>
</View>