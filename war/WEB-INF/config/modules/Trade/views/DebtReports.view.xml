<?xml version="1.0" encoding="UTF-8"?>
<View xmlns="http://www.butent.com/view"
      xmlns:x="http://www.butent.com/expression"

  name="DebtReports" source="Companies" caption="=trdDebtReports"

  >
  <Columns>
    <SimpleColumn name="Name" />
    <SimpleColumn name="ExternalAdvance" />

    <SimpleJoin name="Contact" joinType="LEFT">
      <SimpleJoin name="Email" joinType="LEFT">
        <SimpleColumn name="Email" />
      </SimpleJoin>
    </SimpleJoin>

    <ExternalJoin name="Customer" source="ERPSales" joinType="INNER" filter="Debt > 0" >
      <HiddenColumn name="Debt" />
      <AggregateColumn name="Customer" aggregate="COUNT" alias="DebtCount"  label="=trInvoices" />
      <AggregateColumn name="Debt" aggregate="SUM" alias="DebtSum" />
      <HiddenColumn name="Term" />
      <SimpleColumn name="Currency" />
      <SimpleJoin name="Currency" joinType="LEFT">
        <SimpleColumn name="Name" alias="CurrencyName"/>
      </SimpleJoin>
    </ExternalJoin>

    <SimpleColumn name="BankruptcyRisk"/>
    <SimpleJoin joinType="LEFT" name="BankruptcyRisk">
      <SimpleColumn alias="BankruptcyRiskName" name="Name" />
    </SimpleJoin>

    <SimpleColumn name="DelayedPaymentRisk"/>
    <SimpleJoin joinType="LEFT" name="DelayedPaymentRisk">
      <SimpleColumn alias="DelayedPaymentRiskName" name="Name" />
    </SimpleJoin>
    <SimpleColumn name="FinancialState"/>
    <SimpleJoin joinType="LEFT" name="FinancialState">
      <SimpleColumn alias="FinancialStateName" name="Name" />
    </SimpleJoin>
  </Columns>
  <Order>
    <OrderBy column="Name" />
  </Order>
</View>