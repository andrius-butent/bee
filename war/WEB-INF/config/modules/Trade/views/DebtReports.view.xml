<?xml version="1.0" encoding="UTF-8"?>
<View xmlns="http://www.butent.com/view"
      xmlns:x="http://www.butent.com/expression"

  name="DebtReports" source="Companies" caption="=trdDebtReports"
  
  >
  <Columns>
    <SimpleColumn name="Name" />
    
    <SimpleJoin name="Contact" joinType="LEFT">
      <SimpleJoin name="Email" joinType="LEFT">
        <SimpleColumn name="Email" />
      </SimpleJoin>
    </SimpleJoin>
        
    <ExternalJoin name="Customer" source="Sales" joinType="INNER" >      
      <AggregateColumn name="Customer" aggregate="COUNT" alias="DebtCount" label="=trInvoices" />
      <AggregateColumn name="Amount" aggregate="SUM" alias="AmountSum" />
      <AggregateColumn name="Paid" aggregate="SUM" alias="PaidSum" />
      <SimpleColumn name="DebtAmount" label="=trdDebt">
        <x:minus>
        <x:number>"AmountSum"</x:number>
        <x:nvl type="DECIMAL">
          <x:number>"PaidSum"</x:number>
          <x:number>0</x:number>
        </x:nvl>
      </x:minus>
      </SimpleColumn>
    </ExternalJoin>
    
    <SimpleColumn name="BankruptcyRisk"/>
    <SimpleJoin joinType="LEFT" name="BankruptcyRisk">
      <SimpleColumn alias="BankruptcyRiskName" name="Name" />
    </SimpleJoin>
    
    <SimpleColumn name="DelayedPaymentRisk"/>
    <SimpleJoin joinType="LEFT" name="DelayedPaymentRisk">
      <SimpleColumn alias="DelayedPaymentRiskName" name="Name" />
    </SimpleJoin>
  </Columns>
  <Order>
    <OrderBy column="Name" />
  </Order>
</View>