<?xml version="1.0" encoding="UTF-8"?>
<View xmlns="http://www.butent.com/view"

  name="Messages" source="Messages"
  >
  <Columns>
    <SimpleColumn name="Date" />
    <SimpleColumn name="Subject" />
    <HiddenColumn name="Sender" />
    <HiddenColumn name="Status" alias="SenderStatus" />

    <SimpleJoin name="Sender" joinType="LEFT">
      <SimpleColumn name="Label" alias="SenderLabel" />
      <SimpleColumn name="Email" alias="SenderEmail" />
    </SimpleJoin>

    <ExternalJoin name="Message" source="Recipients" joinType="LEFT">
      <HiddenColumn name="Address" />
      <HiddenColumn name="Status" />
      <AggregateColumn name="Unread" aggregate="MAX" />
      <AggregateColumn name="Address" alias="RecipientCount" aggregate="COUNT_DISTINCT" />

      <AggregateJoin name="Address" joinType="LEFT">
        <AggregateColumn name="Label" alias="RecipientLabel" aggregate="MAX" />
        <AggregateColumn name="Email" alias="RecipientEmail" aggregate="MAX" />
      </AggregateJoin>
    </ExternalJoin>

    <ExternalJoin name="Message" source="Attachments" joinType="LEFT">
      <AggregateColumn name="File" alias="AttachmentCount" aggregate="COUNT_DISTINCT" />
    </ExternalJoin>
  </Columns>
  <Order>
    <OrderBy column="Date" descending="true" />
  </Order>
</View>
 